<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Monopoly Game</title>
<style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }
    
    .player-token {
    width: 5vmin;
    height: 5vmin;
    border-radius: 50%;
    border: 0.5vmin solid black;
    background-clip: padding-box;
    z-index: 20;
    box-shadow: 0 0 1vmin rgba(0,0,0,0.7);
        width: 3vmin;
        height: 3vmin;
        position: absolute;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 1.4vmin;
        color: white;
        transform: rotate(180deg);
        box-shadow: 0 0 0.5vmin rgba(0,0,0,0.5);
        border: 0.2vmin solid white;
        border-radius: 50%;
        transform-origin: center center;
    }

    .player-token:hover {
        transform: scale(1.2) rotate(180deg);
        z-index: 20;
    }

    .player-token.p1 { background: blue; }
    .player-token.p2 { background: red; }
    .player-token.p3 { background: gold; color: black; }
    .player-token.p4 { background: green; }
    .player-token.p5 { background: purple; }
.player-token.p6 { background: brown; }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        background-image: url('bg.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    .board-container {
    width: 95vmin;
    height: 95vmin;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    position: relative;
    }

    .board {
    display: grid;
    grid-template-columns: repeat(11, 1fr);
    grid-template-rows: repeat(11, 1fr);
    width: 90vmin;
    height: 90vmin;
    border: 5px solid #000;
    background-color: #C1E1C1;
    transform: rotate(180deg);
    position: relative;
    }

    .corner {
    background-color: #C1E1C1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    border: 2px solid #000;
    font-size: 1.8vmin;
    padding: 0.5vmin;
    text-align: center;
    transform: rotate(180deg);
    }

    .top-left { grid-area: 1 / 1 / 2 / 2; }
    .top-right { grid-area: 1 / 11 / 2 / 12; }
    .bottom-right { grid-area: 11 / 11 / 12 / 12; }
    .bottom-left { grid-area: 11 / 1 / 12 / 2; }

    .row { display: contents; }

    .top .cell, .bottom .cell {
    transform: rotate(180deg);
    }

    .top .cell { grid-row: 1; }
    .right .cell { grid-column: 11; }
    .bottom .cell { grid-row: 11; }
    .left .cell { grid-column: 1; }

    .cell {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    text-align: center;
    border: 1px solid #000;
    background-color: #fff;
    font-size: 1.4vmin;
    padding: 0.3vmin;
    overflow: hidden;
    position: relative;
    }

    .top .cell, .bottom .cell {
    height: 100%;
    width: auto;
    }

    .left .cell, .right .cell {
    height: auto;
    width: 100%;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    }

    .left .cell { transform: rotate(90deg); }
    .right .cell { transform: rotate(90deg); }

    .cell .name {
    font-weight: bold;
    font-size: 1.3vmin;
    margin-bottom: 0.2vmin;
    }

    .cell .price {
    font-size: 1.1vmin;
    font-weight: bold;
    color: #006400;
    }

    .color-strip {
    width: 100%;
    height: 1.5vmin;
    }

    .left .color-strip, .right .color-strip {
    width: 1.5vmin;
    height: 100%;
    }

    .brown { background-color: #8B4513; }
    .light-blue { background-color: #87CEEB; }
    .pink { background-color: #FF69B4; }
    .orange { background-color: #FFA500; }
    .red { background-color: #FF0000; }
    .yellow { background-color: #FFFF00; }
    .green { background-color: #008000; }
    .dark-blue { background-color: #00008B; }

    .railroad { 
    background-color: #000; 
    color: #fff;
    font-size: 1.2vmin;
    }
    .utility { 
    background-color: #C0C0C0;
    font-size: 1.2vmin;
    }
    .tax { 
    background-color: #FFD700;
    font-size: 1.2vmin;
    }
    .chance { 
    background-color: #FFA07A;
    font-size: 1.3vmin;
    font-weight: bold;
    }
    .chest { 
    background-color: #B0E0E6;
    font-size: 1.3vmin;
    font-weight: bold;
    }

    .center-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(180deg);
    width: 50%;
    height: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 5vmin;
    font-weight: bold;
    color: #006400;
    }

    .player-token {
    width: 5vmin;
    height: 5vmin;
    border-radius: 50%;
    border: 0.5vmin solid black;
    background-clip: padding-box;
    z-index: 20;
    box-shadow: 0 0 1vmin rgba(0,0,0,0.7);
    width: 5vmin;
    height: 5vmin;
    border-radius: 50%;
    position: absolute;
    transition: all 0.5s ease;
    z-index: 10;
    cursor: pointer;
    }

    .game-controls {
    position: absolute;
    right: -280px;
    top: 0;
    width: 270px;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    max-height: 90vh;
    overflow-y: auto;
    }

    .dice-container {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    justify-content: center;
    }

    .die {
    width: 40px;
    height: 40px;
    border: 2px solid #333;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    background: white;
    }

    .player-info {
    margin-bottom: 10px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 0.9em;
    }

    .active-player {
    background-color: #e8f5e9;
    border: 2px solid #4CAF50;
    }

    button {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border: none;
    border-radius: 5px;
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    }

    button:hover {
    background-color: #45a049;
    }

    button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
    }

    #game-log {
    margin-top: 15px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    max-height: 150px;
    overflow-y: auto;
    font-size: 12px;
    }

    .log-entry {
    margin-bottom: 4px;
    padding: 2px 0;
    border-bottom: 1px solid #eee;
    }

    .player-token {
    width: 5vmin;
    height: 5vmin;
    border-radius: 50%;
    border: 0.5vmin solid black;
    background-clip: padding-box;
    z-index: 20;
    box-shadow: 0 0 1vmin rgba(0,0,0,0.7);
            width: 2.5vmin;
            height: 2.5vmin;
            border-radius: 50%;
            position: absolute;
            transition: all 0.5s ease;
            z-index: 10;
            cursor: pointer;
            border: 0.3vmin solid white; /* Added white border for better visibility */
            box-shadow: 0 0 0.5vmin rgba(0,0,0,0.5); /* Added shadow for depth */
    }

    .property-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
        z-index: 1000;
        display: none;
    }

    .property-dialog button {
        margin: 5px;
        padding: 8px 15px;
    }

    .owned-property {
        position: relative;
    }

    .owner-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 1.5vmin;
        height: 1.5vmin;
        border-radius: 50%;
        border: 0.2vmin solid white;
    }

    .ownership-tracker {
position: absolute;
left: -280px;
top: 0;
width: 270px;
background: white;
padding: 15px;
border-radius: 10px;
box-shadow: 0 0 10px rgba(0,0,0,0.1);
max-height: 90vh;
overflow-y: auto;
}

.property-group {
margin-bottom: 15px;
}

.property-group h3 {
font-size: 14px;
margin-bottom: 5px;
padding-bottom: 3px;
border-bottom: 2px solid #eee;
}

.owned-property-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 4px 0;
font-size: 12px;
}

.owner-dot {
width: 12px;
height: 12px;
border-radius: 50%;
border: 1px solid white;
box-shadow: 0 0 2px rgba(0,0,0,0.3);
margin-left: 8px;
}

    </style>
</head>

<body>
<div class="board-container">
    <div class="board">
    <!-- Board content remains the same as in your original code -->
    <div class="corner top-left">GO<br>Collect $200</div>
    <div class="row top">
        <div class="cell" style="grid-column: 2;"><div class="color-strip brown"></div><span class="name">Mediterranean Ave</span><span class="price">$60</span></div>
        <div class="cell chest" style="grid-column: 3;">Community Chest</div>
        <div class="cell" style="grid-column: 4;"><div class="color-strip brown"></div><span class="name">Baltic Ave</span><span class="price">$60</span></div>
        <div class="cell tax" style="grid-column: 5;">Income Tax<br>Pay $150</div>
        <div class="cell railroad" style="grid-column: 6;">Reading Railroad<br>$200</div>
        <div class="cell" style="grid-column: 7;"><div class="color-strip light-blue"></div><span class="name">Oriental Ave</span><span class="price">$100</span></div>
        <div class="cell chance" style="grid-column: 8;">Chance</div>
        <div class="cell" style="grid-column: 9;"><div class="color-strip light-blue"></div><span class="name">Vermont Ave</span><span class="price">$100</span></div>
        <div class="cell" style="grid-column: 10;"><div class="color-strip light-blue"></div><span class="name">Connecticut Ave</span><span class="price">$120</span></div>
    </div>
    <div class="corner top-right">Just Visiting<br>In Jail</div>

    <div class="row right">
        <div class="cell" style="grid-row: 2;"><div class="color-strip pink"></div><span class="name">St. Charles Place</span><span class="price">$140</span></div>
        <div class="cell utility" style="grid-row: 3;">Electric Company<br>$150</div>
        <div class="cell" style="grid-row: 4;"><div class="color-strip pink"></div><span class="name">States Ave</span><span class="price">$140</span></div>
        <div class="cell" style="grid-row: 5;"><div class="color-strip pink"></div><span class="name">Virginia Ave</span><span class="price">$160</span></div>
        <div class="cell railroad" style="grid-row: 6;">Pennsylvania Railroad<br>$200</div>
        <div class="cell" style="grid-row: 7;"><div class="color-strip orange"></div><span class="name">St. James Place</span><span class="price">$180</span></div>
        <div class="cell chest" style="grid-row: 8;">Community Chest</div>
        <div class="cell" style="grid-row: 9;"><div class="color-strip orange"></div><span class="name">Tennessee Ave</span><span class="price">$180</span></div>
        <div class="cell" style="grid-row: 10;"><div class="color-strip orange"></div><span class="name">New York Ave</span><span class="price">$200</span></div>
    </div>

    <div class="corner bottom-right">Free Parking</div>
    
    <div class="row bottom">
        <div class="cell" style="grid-column: 10;"><div class="color-strip red"></div><span class="name">Kentucky Ave</span><span class="price">$220</span></div>
        <div class="cell chance" style="grid-column: 9;">Chance</div>
        <div class="cell" style="grid-column: 8;"><div class="color-strip red"></div><span class="name">Indiana Ave</span><span class="price">$220</span></div>
        <div class="cell" style="grid-column: 7;"><div class="color-strip red"></div><span class="name">Illinois Ave</span><span class="price">$240</span></div>
        <div class="cell railroad" style="grid-column: 6;">B&O Railroad<br>$200</div>
        <div class="cell" style="grid-column: 5;"><div class="color-strip yellow"></div><span class="name">Atlantic Ave</span><span class="price">$260</span></div>
        <div class="cell" style="grid-column: 4;"><div class="color-strip yellow"></div><span class="name">Ventnor Ave</span><span class="price">$260</span></div>
        <div class="cell utility" style="grid-column: 3;">Water Works<br>$150</div>
        <div class="cell" style="grid-column: 2;"><div class="color-strip yellow"></div><span class="name">Marvin Gardens</span><span class="price">$280</span></div>
    </div>

    <div class="corner bottom-left">Go to Jail</div>

    <div class="row left">
        <div class="cell" style="grid-row: 10;"><div class="color-strip green"></div><span class="name">Pacific Ave</span><span class="price">$300</span></div>
        <div class="cell" style="grid-row: 9;"><div class="color-strip green"></div><span class="name">North Carolina Ave</span><span class="price">$300</span></div>
        <div class="cell chest" style="grid-row: 8;">Community Chest</div>
        <div class="cell" style="grid-row: 7;"><div class="color-strip green"></div><span class="name">Pennsylvania Ave</span><span class="price">$320</span></div>
        <div class="cell railroad" style="grid-row: 6;">Short Line Railroad<br>$200</div>
        <div class="cell chance" style="grid-row: 5;">Chance</div>
        <div class="cell" style="grid-row: 4;"><div class="color-strip dark-blue"></div><span class="name">Park Place</span><span class="price">$350</span></div>
        <div class="cell tax" style="grid-row: 3;">Luxury Tax<br>Pay $75</div>
        <div class="cell" style="grid-row: 2;"><div class="color-strip dark-blue"></div><span class="name">Boardwalk</span><span class="price">$400</span></div>
    </div>

    <div class="center-image">MONOPOLY</div>
    </div>

    <div class="game-controls">
    <div class="dice-container">
        <div class="die" id="die1">1</div>
        <div class="die" id="die2">1</div>
    </div>
    
    <div id="player1" class="player-info active-player">
        <h3>Player 1 ðŸ”µ</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>
    
    <div id="player2" class="player-info">
        <h3>Player 2 ðŸ”´</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>

    <div id="player3" class="player-info">
        <h3>Player 3 ðŸŸ¡</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>

    <div id="player4" class="player-info">
        <h3>Player 4 ðŸŸ¢</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>
    <div id="player5" class="player-info">
        <h3>Player 5 ðŸŸ£</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>
    <div id="player6" class="player-info">
        <h3>Player 6 ðŸŸ¤</h3>
        <p>Money: $<span class="money">1500</span></p>
        <p>Position: <span class="position">GO</span></p>
    </div>

    <button id="rollDice">Roll Dice</button>
    <button id="endTurn" disabled>End Turn</button>
    
    <div id="game-log">
        <div class="log-entry">Game started. All players at GO</div>
    </div>
    </div>
    <div class="ownership-tracker">
        <h2>Property Ownership</h2>
        <div class="property-group">
            <h3>Brown Properties</h3>
            <div id="brown-properties"></div>
        </div>
        <div class="property-group">
            <h3>Light Blue Properties</h3>
            <div id="light-blue-properties"></div>
        </div>
        <div class="property-group">
            <h3>Pink Properties</h3>
            <div id="pink-properties"></div>
        </div>
        <div class="property-group">
            <h3>Orange Properties</h3>
            <div id="orange-properties"></div>
        </div>
        <div class="property-group">
            <h3>Red Properties</h3>
            <div id="red-properties"></div>
        </div>
        <div class="property-group">
            <h3>Yellow Properties</h3>
            <div id="yellow-properties"></div>
        </div>
        <div class="property-group">
            <h3>Green Properties</h3>
            <div id="green-properties"></div>
        </div>
        <div class="property-group">
            <h3>Dark Blue Properties</h3>
            <div id="dark-blue-properties"></div>
        </div>
        <div class="property-group">
            <h3>Railroads</h3>
            <div id="railroad-properties"></div>
        </div>
        <div class="property-group">
            <h3>Utilities</h3>
            <div id="utility-properties"></div>
        </div>
    </div>
</div>
<div id="propertyDialog" class="property-dialog">
    <h3>Buy Property</h3>
    <p>Would you like to buy <span id="propertyName"></span> for $<span id="propertyPrice"></span>?</p>
    <button id="buyProperty">Buy</button>
    <button id="skipProperty">Skip</button>
</div>
<script>
    const players = [
    { id: 1, color: '#0000FF', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 },
    { id: 2, color: '#FF0000', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 },
    { id: 3, color: '#FFD700', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 },
    { id: 4, color: '#008000', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 },
    { id: 5, color: '#800080', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 },
    { id: 6, color: '#A52A2A', position: 0, money: 1500, element: null, inJail: false, jailTurns: 0 }
];

let currentPlayer = 0;
let hasRolled = false;

// Update endTurn button for 5 players
document.getElementById('endTurn').addEventListener('click', () => {
    if (!hasRolled) {
        alert("You must roll first!");
        return;
    }

    document.getElementById('rollDice').disabled = false;
    document.getElementById('endTurn').disabled = true;

    document.querySelector(`#player${players[currentPlayer].id}`).classList.remove('active-player');
    currentPlayer = (currentPlayer + 1) % 6;  // Cycle through 6 players
    document.querySelector(`#player${players[currentPlayer].id}`).classList.add('active-player');

    hasRolled = false;
    addLogEntry(`Player ${players[currentPlayer].id}'s turn`);
});


    // Board positions (0 = GO, moving clockwise)
const boardPositions = calculateBoardPositions();

const propertyNames = [
    "GO", "Mediterranean Avenue", "Community Chest", "Baltic Avenue", "Income Tax",
    "Reading Railroad", "Oriental Avenue", "Chance", "Vermont Avenue", "Connecticut Avenue",
    "Jail", "St. Charles Place", "Electric Company", "States Avenue", "Virginia Avenue",
    "Pennsylvania Railroad", "St. James Place", "Community Chest", "Tennessee Avenue", "New York Avenue",
    "Free Parking", "Kentucky Avenue", "Chance", "Indiana Avenue", "Illinois Avenue",
    "B&O Railroad", "Atlantic Avenue", "Ventnor Avenue", "Water Works", "Marvin Gardens",
    "Go to Jail", "Pacific Avenue", "North Carolina Avenue", "Community Chest", "Pennsylvania Avenue",
    "Short Line Railroad", "Chance", "Park Place", "Luxury Tax", "Boardwalk"
];

const properties = {
1: { name: "Mediterranean Avenue", price: 60, group: "brown" },
3: { name: "Baltic Avenue", price: 60, group: "brown" },
6: { name: "Oriental Avenue", price: 100, group: "light-blue" },
8: { name: "Vermont Avenue", price: 100, group: "light-blue" },
9: { name: "Connecticut Avenue", price: 120, group: "light-blue" },
11: { name: "St. Charles Place", price: 140, group: "pink" },
13: { name: "States Avenue", price: 140, group: "pink" },
14: { name: "Virginia Avenue", price: 160, group: "pink" },
16: { name: "St. James Place", price: 180, group: "orange" },
18: { name: "Tennessee Avenue", price: 180, group: "orange" },
19: { name: "New York Avenue", price: 200, group: "orange" },
21: { name: "Kentucky Avenue", price: 220, group: "red" },
23: { name: "Indiana Avenue", price: 220, group: "red" },
24: { name: "Illinois Avenue", price: 240, group: "red" },
26: { name: "Atlantic Avenue", price: 260, group: "yellow" },
27: { name: "Ventnor Avenue", price: 260, group: "yellow" },
29: { name: "Marvin Gardens", price: 280, group: "yellow" },
31: { name: "Pacific Avenue", price: 300, group: "green" },
32: { name: "North Carolina Avenue", price: 300, group: "green" },
34: { name: "Pennsylvania Avenue", price: 320, group: "green" },
37: { name: "Park Place", price: 350, group: "dark-blue" },
39: { name: "Boardwalk", price: 400, group: "dark-blue" },
// Railroads
5: { name: "Reading Railroad", price: 200, group: "railroad" },
15: { name: "Pennsylvania Railroad", price: 200, group: "railroad" },
25: { name: "B&O Railroad", price: 200, group: "railroad" },
35: { name: "Short Line Railroad", price: 200, group: "railroad" },
// Utilities
12: { name: "Electric Company", price: 150, group: "utility" },
28: { name: "Water Works", price: 150, group: "utility" }
};

    // Add property ownership tracking
    const propertyOwnership = {};

function calculateBoardPositions() {
const positions = [];
const boardSize = 90; // vmin
const squareSize = boardSize / 11;
const centerOffset = 2.5; // vmin

// Top row (left to right)
for (let i = 1; i <= 10; i++) {
    positions.push({
        left: `${i * squareSize + centerOffset}vmin`,
        top: `${centerOffset}vmin`
    });
}

// Right column (top to bottom)
for (let i = 1; i <= 9; i++) {
    positions.push({
        left: `${boardSize - squareSize + centerOffset}vmin`,
        top: `${i * squareSize + centerOffset}vmin`
    });
}

// Bottom row (GO to Jail)
for (let i = 10; i >= 0; i--) {
    positions.push({
        left: `${i * squareSize + centerOffset}vmin`,
        top: `${boardSize - squareSize + centerOffset}vmin`
    });
}

// Left column (going up)
for (let i = 9; i >= 0; i--) {
    positions.push({
        left: `${centerOffset}vmin`,
        top: `${i * squareSize + centerOffset}vmin`
    });
}

return positions;
}

function createPlayerTokens() {
const board = document.querySelector('.board');
const tokenOffsets = [
    { x: -1, y: -1 },  // Adjusted offsets for better spacing
    { x: 1, y: -1 },
    { x: -1, y: 1 },
    { x: 1, y: 1 },
    { x: 0, y: 0 },  // Offset for Player 5
    { x: 0, y: 1 }   // Offset for Player 6
];

const boardPositions = calculateBoardPositions();
const startPosition = boardPositions[39]; // GO position

players.forEach((player, index) => {
    const token = document.createElement('div');
    token.className = `player-token p${player.id}`;
    token.textContent = (index + 1).toString();
    
    // Convert vmin string to number for offset calculation
    const baseLeft = parseFloat(startPosition.left);
    const baseTop = parseFloat(startPosition.top);
    
    // Apply offset for each player token
    token.style.left = `${baseLeft + tokenOffsets[index].x}vmin`;
    token.style.top = `${baseTop + tokenOffsets[index].y}vmin`;
    
    board.appendChild(token);
    players[index].element = token;
});
}

function updatePlayerPosition(playerIndex, newPosition, diceRoll) {
    const player = players[playerIndex];
    const boardPositions = calculateBoardPositions();
    const tokenOffsets = [
        { x: -0.75, y: -0.75 },
        { x: 0.75, y: -0.75 },
        { x: -0.75, y: 0.75 },
        { x: 0.75, y: 0.75 },
        { x: 0.5, y: -0.5 },  // Offset for Player 5
        { x: 0.75, y: 0.75 }  // Offset for Player 6
    ];
    
    const spacesToMove = (newPosition - player.position + 40) % 40;
    console.log(`Moving player ${playerIndex + 1} (${player.id}) ${spacesToMove} spaces.`);
    let currentSpace = player.position - 1;
    let moveDelay = 0;

    // Animate movement one space at a time
    for (let i = 0; i < spacesToMove; i++) {
        setTimeout(() => {
            currentSpace = (currentSpace + 1) % 40;
            if (playerIndex === 5) { console.log(`Player 6 moving to space ${currentSpace}`); }
            const pos = boardPositions[currentSpace];
            const offsetX = tokenOffsets[playerIndex].x * 2;
            const offsetY = tokenOffsets[playerIndex].y * 2;
            
            const baseLeft = parseFloat(pos.left);
            const baseTop = parseFloat(pos.top);
            
            player.element.style.left = `${baseLeft + offsetX}vmin`;
            player.element.style.top = `${baseTop + offsetY}vmin`;
            
        }, moveDelay);
        
        moveDelay += 250;
    }
    
    setTimeout(() => {
        player.position = newPosition;
        document.querySelector(`#player${player.id} .position`).textContent = propertyNames[newPosition];
        
        // Handle special squares
        switch(newPosition) {
            case 0: // GO
                // Already handled in main game loop
                break;
            case 4: // Income Tax
                updatePlayerMoney(playerIndex, -150);
                addLogEntry(`Player ${player.id} paid $150 in Income Tax`);
                break;
            case 38: // Luxury Tax
                updatePlayerMoney(playerIndex, -75);
                addLogEntry(`Player ${player.id} paid $75 in Luxury Tax`);
                break;
            case 30: // Go to Jail
                goToJail(playerIndex);
                break;
                case 2: // Community Chest
            case 17:
            case 33:
                handleCommunityChest(playerIndex);
                break;
            case 7: // Chance
            case 22:
            case 36:
                handleChance(playerIndex);
                break;
            case 10: // Just visiting jail
                addLogEntry(`Player ${player.id} is just visiting jail`);
                break;
            case 20: // Free Parking
                addLogEntry(`Player ${player.id} landed on Free Parking`);
                break;
            default:
                // Handle property squares
                if (properties[newPosition]) {
                    if (!propertyOwnership[newPosition]) {
                        offerProperty(newPosition);
                    } else {
                        const owner = propertyOwnership[newPosition];
                        if (owner !== player.id) {
                            const rent = calculateRent(newPosition, diceRoll);
                            updatePlayerMoney(playerIndex, -rent);
                            updatePlayerMoney(owner - 1, rent);
                            addLogEntry(`Player ${player.id} paid $${rent} rent to Player ${owner}`);
                        }
                    }
                }
        }
    }, moveDelay);
    
    return moveDelay;
}

// Update the roll dice event listener to account for animation timing
document.getElementById('rollDice').addEventListener('click', () => {
        if (hasRolled) return;  // Silently return instead of showing notification

        const die1 = rollDice();
        const die2 = rollDice();
        const total = die1 + die2;

        document.getElementById('die1').textContent = die1;
        document.getElementById('die2').textContent = die2;

        const player = players[currentPlayer];
        let newPosition = (player.position + total) % 40;
        console.log(`Player ${player.id} rolled ${total} and will move to position ${newPosition}`);
        
        if (newPosition < player.position) {
            setTimeout(() => {
                updatePlayerMoney(currentPlayer, 200);
                addLogEntry(`Player ${player.id} passed GO and collected $200!`);
            }, ((40 - player.position) * 200));
        }

        const animationDuration = updatePlayerPosition(currentPlayer, newPosition);
        
        setTimeout(() => {
            addLogEntry(`Player ${player.id} rolled ${total} (${die1}+${die2}) and landed on ${propertyNames[newPosition]}`);
        }, animationDuration);

        hasRolled = true;
        document.getElementById('rollDice').disabled = true;
        document.getElementById('endTurn').disabled = false;
    });

    function offerProperty(position) {
    const property = properties[position];
    const propertyDialog = document.getElementById('propertyDialog');
    const propertyNameSpan = document.getElementById('propertyName');
    const propertyPriceSpan = document.getElementById('propertyPrice');
    
    if (!property) {
        console.error('Invalid property position:', position);
        return;
    }
    
    // Don't offer if mortgaged
    if (mortgagedProperties.has(position)) {
        addLogEntry(`${property.name} is mortgaged and cannot be purchased.`);
        return;
    }
    
    propertyNameSpan.textContent = property.name;
    propertyPriceSpan.textContent = property.price.toLocaleString();
    propertyDialog.style.display = 'block';
    
    document.getElementById('buyProperty').onclick = () => {
        const player = players[currentPlayer];
        const price = Number(property.price);
        
        if (player.money >= price) {
            updatePlayerMoney(currentPlayer, -price);
            propertyOwnership[position] = player.id;
            propertyDevelopment[position] = 0;
            addLogEntry(`Player ${player.id} bought ${property.name} for $${price.toLocaleString()}`);
            addOwnerIndicator(position, player.id);
            updateOwnershipTracker();
        } else {
            addLogEntry(`Player ${player.id} cannot afford ${property.name}`);
        }
        propertyDialog.style.display = 'none';
    };
    
    document.getElementById('skipProperty').onclick = () => {
        propertyDialog.style.display = 'none';
        addLogEntry(`Player ${players[currentPlayer].id} declined to buy ${property.name}`);
    };
}

const propertyRents = {
    // Brown properties
    1: { base: 2, oneHouse: 10, twoHouses: 30, threeHouses: 90, fourHouses: 160, hotel: 250 },
    3: { base: 4, oneHouse: 20, twoHouses: 60, threeHouses: 180, fourHouses: 320, hotel: 450 },
    
    // Light Blue properties
    6: { base: 6, oneHouse: 30, twoHouses: 90, threeHouses: 270, fourHouses: 400, hotel: 550 },
    8: { base: 6, oneHouse: 30, twoHouses: 90, threeHouses: 270, fourHouses: 400, hotel: 550 },
    9: { base: 8, oneHouse: 40, twoHouses: 100, threeHouses: 300, fourHouses: 450, hotel: 600 },
    
    // Pink properties
    11: { base: 10, oneHouse: 50, twoHouses: 150, threeHouses: 450, fourHouses: 625, hotel: 750 },
    13: { base: 10, oneHouse: 50, twoHouses: 150, threeHouses: 450, fourHouses: 625, hotel: 750 },
    14: { base: 12, oneHouse: 60, twoHouses: 180, threeHouses: 500, fourHouses: 700, hotel: 900 },
    
    // Orange properties
    16: { base: 14, oneHouse: 70, twoHouses: 200, threeHouses: 550, fourHouses: 750, hotel: 950 },
    18: { base: 14, oneHouse: 70, twoHouses: 200, threeHouses: 550, fourHouses: 750, hotel: 950 },
    19: { base: 16, oneHouse: 80, twoHouses: 220, threeHouses: 600, fourHouses: 800, hotel: 1000 },
    
    // Red properties
    21: { base: 18, oneHouse: 90, twoHouses: 250, threeHouses: 700, fourHouses: 875, hotel: 1050 },
    23: { base: 18, oneHouse: 90, twoHouses: 250, threeHouses: 700, fourHouses: 875, hotel: 1050 },
    24: { base: 20, oneHouse: 100, twoHouses: 300, threeHouses: 750, fourHouses: 925, hotel: 1100 },
    
    // Yellow properties
    26: { base: 22, oneHouse: 110, twoHouses: 330, threeHouses: 800, fourHouses: 975, hotel: 1150 },
    27: { base: 22, oneHouse: 110, twoHouses: 330, threeHouses: 800, fourHouses: 975, hotel: 1150 },
    29: { base: 24, oneHouse: 120, twoHouses: 360, threeHouses: 850, fourHouses: 1025, hotel: 1200 },
    
    // Green properties
    31: { base: 26, oneHouse: 130, twoHouses: 390, threeHouses: 900, fourHouses: 1100, hotel: 1275 },
    32: { base: 26, oneHouse: 130, twoHouses: 390, threeHouses: 900, fourHouses: 1100, hotel: 1275 },
    34: { base: 28, oneHouse: 150, twoHouses: 450, threeHouses: 1000, fourHouses: 1200, hotel: 1400 },
    
    // Dark Blue properties
    37: { base: 35, oneHouse: 175, twoHouses: 500, threeHouses: 1100, fourHouses: 1300, hotel: 1500 },
    39: { base: 50, oneHouse: 200, twoHouses: 600, threeHouses: 1400, fourHouses: 1700, hotel: 2000 },
    
    // Railroads (rent depends on number owned)
    5: { base: 25, two: 50, three: 100, four: 200 },
    15: { base: 25, two: 50, three: 100, four: 200 },
    25: { base: 25, two: 50, three: 100, four: 200 },
    35: { base: 25, two: 50, three: 100, four: 200 },
    
    // Utilities (rent is 4x or 10x dice roll)
    12: { multiplier: 4, twoOwned: 10 },
    28: { multiplier: 4, twoOwned: 10 }
};

const propertyDevelopment = {};
const mortgagedProperties = new Set();

// Function to calculate rent for a property
function calculateRent(position, diceRoll) {
    const property = properties[position];
    const rentConfig = propertyRents[position];
    const owner = propertyOwnership[position];
    
    if (!owner || mortgagedProperties.has(position)) {
        return 0;
    }

    // Check if the property is mortgaged
    if (mortgagedProperties.has(position)) {
        return 0;
    }

    // Railroad rent calculation
    if (property.group === 'railroad') {
        const railroadsOwned = Object.entries(propertyOwnership)
            .filter(([pos, ownerId]) => 
                properties[pos]?.group === 'railroad' && 
                ownerId === owner
            ).length;
        return 25 * Math.pow(2, railroadsOwned - 1); // 25, 50, 100, 200
    }
    
    // Utility rent calculation
    if (property.group === 'utility') {
        const utilitiesOwned = Object.entries(propertyOwnership)
            .filter(([pos, ownerId]) => 
                properties[pos]?.group === 'utility' && 
                ownerId === owner
            ).length;
        return diceRoll * (utilitiesOwned === 2 ? 10 : 4);
    }

    // Regular property rent calculation
    const development = propertyDevelopment[position] || 0;
    const developmentLevels = ['base', 'oneHouse', 'twoHouses', 'threeHouses', 'fourHouses', 'hotel'];
    
    // Check if owner has monopoly
    const hasMonopoly = checkMonopoly(owner, property.group);
    
    // If no houses but has monopoly, rent is doubled
    if (development === 0 && hasMonopoly) {
        return rentConfig.base * 2;
    }
    
    return rentConfig[developmentLevels[development]];
}

function checkMonopoly(playerId, propertyGroup) {
    // Get all properties in the group
    const groupProperties = Object.entries(properties)
        .filter(([_, prop]) => prop.group === propertyGroup)
        .map(([pos, _]) => parseInt(pos));
    
    // Check if player owns all properties in the group
    return groupProperties.every(pos => propertyOwnership[pos] === playerId);
}

function mortgageProperty(position) {
    const property = properties[position];
    const owner = propertyOwnership[position];
    const mortgageValue = Math.floor(property.price / 2);
    
    if (mortgagedProperties.has(position)) {
        addLogEntry(`${property.name} is already mortgaged.`);
        return;
    }
    
    mortgagedProperties.add(position);
    updatePlayerMoney(owner - 1, mortgageValue);
    addLogEntry(`Player ${owner} mortgaged ${property.name} for $${mortgageValue}`);
    updateOwnershipTracker();
}

function unmortgageProperty(position) {
    const property = properties[position];
    const owner = propertyOwnership[position];
    const unmortgageCost = Math.floor(property.price * 0.55); // 50% + 10% interest
    
    if (!mortgagedProperties.has(position)) {
        addLogEntry(`${property.name} is not mortgaged.`);
        return;
    }
    
    if (players[owner - 1].money >= unmortgageCost) {
        mortgagedProperties.delete(position);
        updatePlayerMoney(owner - 1, -unmortgageCost);
        addLogEntry(`Player ${owner} unmortgaged ${property.name} for $${unmortgageCost}`);
        updateOwnershipTracker();
    } else {
        addLogEntry(`Player ${owner} cannot afford to unmortgage ${property.name}`);
    }
}

function sellProperty(position, buyerId) {
    const property = properties[position];
    const currentOwner = propertyOwnership[position];
    const sellingPrice = property.price; // This could be negotiated in a more complex version
    
    if (!currentOwner) {
        addLogEntry(`This property is not owned.`);
        return;
    }
    
    if (propertyDevelopment[position] > 0) {
        addLogEntry(`Cannot sell property with houses/hotels. Sell buildings first.`);
        return;
    }
    
    if (players[buyerId - 1].money >= sellingPrice) {
        updatePlayerMoney(buyerId - 1, -sellingPrice);
        updatePlayerMoney(currentOwner - 1, sellingPrice);
        propertyOwnership[position] = buyerId;
        addLogEntry(`Player ${currentOwner} sold ${property.name} to Player ${buyerId} for $${sellingPrice}`);
        addOwnerIndicator(position, buyerId);
        updateOwnershipTracker();
    } else {
        addLogEntry(`Player ${buyerId} cannot afford to buy ${property.name}`);
    }
}

function updateOwnershipTracker() {
// Clear existing ownership displays
Object.keys(properties).forEach(groupId => {
    const container = document.getElementById(`${properties[groupId].group}-properties`);
    if (container) {
        container.innerHTML = '';
    }
});

// Group properties by their color/type
const groups = {};
Object.entries(propertyOwnership).forEach(([position, ownerId]) => {
    const property = properties[position];
    if (property) {
        if (!groups[property.group]) {
            groups[property.group] = [];
        }
        groups[property.group].push({
            name: property.name,
            owner: ownerId,
            position: position
        });
    }
});

// Update the display for each group
Object.entries(groups).forEach(([group, props]) => {
    const container = document.getElementById(`${group}-properties`);
    if (container) {
        container.innerHTML = props.map(prop => `
            <div class="owned-property-item">
                <span>${prop.name}</span>
                <div class="owner-dot" style="background-color: ${players[prop.owner - 1].color}"></div>
            </div>
        `).join('');
    }
});

// Fill empty groups with "No properties owned" message
document.querySelectorAll('.property-group').forEach(group => {
    const groupId = group.querySelector('div').id.replace('-properties', '');
    const container = document.getElementById(`${groupId}-properties`);
    if (!container.innerHTML.trim()) {
        container.innerHTML = '<div class="owned-property-item">No properties owned</div>';
    }
});
}

function addOwnerIndicator(position, playerId) {
const board = document.querySelector('.board');
const properties = board.querySelectorAll('.cell');
let targetCell;

// Correct indexing based on board position
if (position >= 1 && position <= 9) {
    // Top row
    targetCell = properties[position - 1];
} else if (position >= 11 && position <= 19) {
    // Right side
    targetCell = properties[position - 2];
} else if (position >= 21 && position <= 29) {
    // Bottom row
    targetCell = properties[position - 3];
} else if (position >= 31 && position <= 39) {
    // Left side
    targetCell = properties[position - 4];
}

if (targetCell) {
    // Remove existing indicator if any
    const existingIndicator = targetCell.querySelector('.owner-indicator');
    if (existingIndicator) {
        existingIndicator.remove();
    }

    // Add new indicator
    const indicator = document.createElement('div');
    indicator.className = 'owner-indicator';
    indicator.style.backgroundColor = players[playerId - 1].color;
    targetCell.appendChild(indicator);
}
}

    // Initialize the property dialog
    document.addEventListener('DOMContentLoaded', () => {
        const dialog = document.createElement('div');
        dialog.id = 'propertyDialog';
        dialog.className = 'property-dialog';
        dialog.innerHTML = `
            <h3>Buy Property</h3>
            <p>Would you like to buy <span id="propertyName"></span> for $<span id="propertyPrice"></span>?</p>
            <button id="buyProperty">Buy</button>
            <button id="skipProperty">Skip</button>
        `;
        document.body.appendChild(dialog);
        updateOwnershipTracker();
    });

    function updatePlayerMoney(playerIndex, amount) {
    // Ensure both values are numbers
    const currentMoney = Number(players[playerIndex].money);
    const changeAmount = Number(amount);
    
    // Check if values are valid numbers
    if (isNaN(currentMoney) || isNaN(changeAmount)) {
        console.error('Invalid money values:', {
            playerIndex,
            currentMoney: players[playerIndex].money,
            changeAmount: amount
        });
        return;
    }
    players[playerIndex].money = currentMoney + changeAmount;
    
    // Update display with proper formatting
    const moneyDisplay = document.querySelector(`#player${players[playerIndex].id} .money`);
    if (moneyDisplay) {
        moneyDisplay.textContent = players[playerIndex].money.toLocaleString();
    }
    
    // Log the transaction for debugging
    console.log(`Player ${players[playerIndex].id} money updated:`, {
        previous: currentMoney,
        change: changeAmount,
        new: players[playerIndex].money
    });
    }


function rollDice() {
    return Math.floor(Math.random() * 6) + 1;
    }

    const chanceCards = [
    { text: "Advance to GO", action: (playerIndex) => updatePlayerPosition(playerIndex, 0) },
    { text: "Advance to Illinois Avenue", action: (playerIndex) => updatePlayerPosition(playerIndex, 24) },
    { text: "Advance to St. Charles Place", action: (playerIndex) => updatePlayerPosition(playerIndex, 11) },
    { text: "Advance to nearest Railroad", action: (playerIndex) => {
        const railroads = [5, 15, 25, 35];
        const playerPos = players[playerIndex].position;
        const nextRR = railroads.find(pos => pos > playerPos) || railroads[0];
        updatePlayerPosition(playerIndex, nextRR);
    }},
    { text: "Bank pays you dividend of $50", action: (playerIndex) => updatePlayerMoney(playerIndex, 50) },
    { text: "Go Back 3 Spaces", action: (playerIndex) => {
        const newPos = (players[playerIndex].position - 3 + 40) % 40;
        updatePlayerPosition(playerIndex, newPos);
    }},
    { text: "Go to Jail", action: (playerIndex) => goToJail(playerIndex) },
    { text: "Make general repairs on all your property. For each house pay $25, for each hotel pay $100", 
      action: (playerIndex) => {
        let totalCost = 0;
        Object.entries(propertyOwnership).forEach(([pos, owner]) => {
            if (owner === players[playerIndex].id) {
                const development = propertyDevelopment[pos] || 0;
                if (development === 5) { // Hotel
                    totalCost += 100;
                } else {
                    totalCost += development * 25;
                }
            }
        });
        updatePlayerMoney(playerIndex, -totalCost);
        addLogEntry(`Player ${players[playerIndex].id} paid $${totalCost} for repairs`);
    }},
    { text: "Pay speeding fine of $15", action: (playerIndex) => updatePlayerMoney(playerIndex, -15) },
    { text: "Take a trip to Reading Railroad", action: (playerIndex) => updatePlayerPosition(playerIndex, 5) },
    { text: "You have been elected Chairman of the Board. Pay each player $50", 
      action: (playerIndex) => {
        players.forEach((_, idx) => {
            if (idx !== playerIndex) {
                updatePlayerMoney(idx, 50);
                updatePlayerMoney(playerIndex, -50);
            }
        });
    }},
    { text: "Your building loan matures. Collect $150", action: (playerIndex) => updatePlayerMoney(playerIndex, 150) }
];

const communityChestCards = [
    { text: "Advance to GO", action: (playerIndex) => updatePlayerPosition(playerIndex, 0) },
    { text: "Bank error in your favor. Collect $200", action: (playerIndex) => updatePlayerMoney(playerIndex, 200) },
    { text: "Doctor's fee. Pay $50", action: (playerIndex) => updatePlayerMoney(playerIndex, -50) },
    { text: "From sale of stock you get $50", action: (playerIndex) => updatePlayerMoney(playerIndex, 50) },
    { text: "Go to Jail", action: (playerIndex) => goToJail(playerIndex) },
    { text: "Holiday fund matures. Receive $100", action: (playerIndex) => updatePlayerMoney(playerIndex, 100) },
    { text: "Income tax refund. Collect $20", action: (playerIndex) => updatePlayerMoney(playerIndex, 20) },
    { text: "Life insurance matures. Collect $100", action: (playerIndex) => updatePlayerMoney(playerIndex, 100) },
    { text: "Pay hospital fees of $100", action: (playerIndex) => updatePlayerMoney(playerIndex, -100) },
    { text: "Pay school fees of $50", action: (playerIndex) => updatePlayerMoney(playerIndex, -50) },
    { text: "Receive $25 consultancy fee", action: (playerIndex) => updatePlayerMoney(playerIndex, 25) },
    { text: "You are assessed for street repairs. $40 per house, $115 per hotel",
      action: (playerIndex) => {
        let totalCost = 0;
        Object.entries(propertyOwnership).forEach(([pos, owner]) => {
            if (owner === players[playerIndex].id) {
                const development = propertyDevelopment[pos] || 0;
                if (development === 5) { // Hotel
                    totalCost += 115;
                } else {
                    totalCost += development * 40;
                }
            }
        });
        updatePlayerMoney(playerIndex, -totalCost);
        addLogEntry(`Player ${players[playerIndex].id} paid $${totalCost} for street repairs`);
    }},
    { text: "You have won second prize in a beauty contest. Collect $10", 
      action: (playerIndex) => updatePlayerMoney(playerIndex, 10) },
    { text: "You inherit $100", action: (playerIndex) => updatePlayerMoney(playerIndex, 100) }
];

// Shuffle functions for the cards
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Initialize card decks
let chanceCardDeck = [...chanceCards];
let communityChestDeck = [...communityChestCards];
shuffleArray(chanceCardDeck);
shuffleArray(communityChestDeck);

// Function to draw a card from either deck
function drawCard(deck) {
    if (deck.length === 0) {
        // Reshuffle if deck is empty
        deck = deck === chanceCardDeck ? [...chanceCards] : [...communityChestCards];
        shuffleArray(deck);
    }
    return deck.pop();
}

// Function to handle Chance spaces
function handleChance(playerIndex) {
    const card = drawCard(chanceCardDeck);
    addLogEntry(`Player ${players[playerIndex].id} drew Chance: ${card.text}`);
    
    // Create and show card dialog
    showCardDialog('Chance', card.text, () => {
        card.action(playerIndex);
    });
}

// Function to handle Community Chest spaces
function handleCommunityChest(playerIndex) {
    const card = drawCard(communityChestDeck);
    addLogEntry(`Player ${players[playerIndex].id} drew Community Chest: ${card.text}`);
    
    // Create and show card dialog
    showCardDialog('Community Chest', card.text, () => {
        card.action(playerIndex);
    });
}

// Function to show card dialog
function showCardDialog(type, text, callback) {
    const dialog = document.createElement('div');
    dialog.className = 'card-dialog';
    dialog.innerHTML = `
        <div class="card-content">
            <h3>${type}</h3>
            <p>${text}</p>
            <button class="ok-button">OK</button>
        </div>
    `;
    
    // Add styles for the dialog
    dialog.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 1000;
        text-align: center;
    `;
    
    document.body.appendChild(dialog);
    
    // Handle OK button click
    const okButton = dialog.querySelector('.ok-button');
    okButton.onclick = () => {
        dialog.remove();
        if (callback) callback();
    };
}

function addLogEntry(text) {
    const log = document.getElementById('game-log');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = text;
    log.insertBefore(entry, log.firstChild);
    }

    document.getElementById('rollDice').addEventListener('click', () => {
    if (hasRolled) {
        showNotification("You've already rolled! End your turn.");
        return;
    }

    const die1 = rollDice();
    const die2 = rollDice();
    const total = die1 + die2;

    document.getElementById('die1').textContent = die1;
    document.getElementById('die2').textContent = die2;

    const player = players[currentPlayer];
    let newPosition = (player.position + total) % 40;
        console.log(`Player ${player.id} rolled ${total} and will move to position ${newPosition}`);

    updatePlayerPosition(currentPlayer, newPosition);
    addLogEntry(`Player ${player.id} rolled ${total} (${die1}+${die2}) and landed on ${propertyNames[newPosition]}`);

    hasRolled = true;
    document.getElementById('rollDice').disabled = true;
    document.getElementById('endTurn').disabled = false;
    });

    document.getElementById('endTurn').addEventListener('click', () => {
    if (!hasRolled) {
        showNotification("You must roll first!");
        return;
    }

    document.getElementById('rollDice').disabled = false;
    document.getElementById('endTurn').disabled = true;
    
    document.querySelector(`#player${players[currentPlayer].id}`).classList.remove('active-player');
    currentPlayer = (currentPlayer + 1) % 4;
    document.querySelector(`#player${players[currentPlayer].id}`).classList.add('active-player');
    
    hasRolled = false;
    addLogEntry(`Player ${players[currentPlayer].id}'s turn`);
    });

    document.addEventListener('DOMContentLoaded', () => {
// Add the required styles
const tokenStyles = `
    .player-token {
    width: 5vmin;
    height: 5vmin;
    border-radius: 50%;
    border: 0.5vmin solid black;
    background-clip: padding-box;
    z-index: 20;
    box-shadow: 0 0 1vmin rgba(0,0,0,0.7);
        width: 2.5vmin;
        height: 2.5vmin;
        position: absolute;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 1.4vmin;
        color: white;
        transform: rotate(180deg);
        box-shadow: 0 0 0.5vmin rgba(0,0,0,0.5);
        border: 0.2vmin solid white;
        border-radius: 50%;
    }

    .player-token.p1 { background: blue; }
    .player-token.p2 { background: red; }
    .player-token.p3 { background: gold; color: black; }
    .player-token.p4 { background: green; }
`;

const styleSheet = document.createElement("style");
styleSheet.textContent = tokenStyles;
document.head.appendChild(styleSheet);
createPlayerTokens();

// Initialize game state
document.querySelectorAll('.player-info .position').forEach(el => {
    el.textContent = "GO";
});

addLogEntry("Game started. All players at GO!");
});
</script>
</body>
</html>